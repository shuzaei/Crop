# Crop Programming Language

Crop (Colored-tiles Rotation Puzzle) とは，2 次元グリッドをベースとしたチューリング完全プログラミング言語である．

## 概要

Crop 言語のプログラムは，2 次元の色付き (実装上は整数) グリッドを受け取り，処理を行って出力するという，極めて稀なシステムを備えている．処理命令は **Rotation** と **Loop** の 2 種類だけであり，それぞれ，次のような動作を行う．

- **Rotation**: グリッドのすべての行あるいは列に対し，その行あるいは列が含む指定した色のマスの個数だけ，指定した方向にすべてのマスを移動させる．はみ出たマスはループして反対の端に戻る．

  - ```
    v 0
    > 0
    ```

- **Loop**: 条件を満たす間，ブロック内の命令を実行する．条件は，「マス X とマス Y が同じ色である」または「マス X がある色 Y である」または「ある色 X がある色 Y である 」またはそれらの否定のどれかである．

  - ```
    on [0, 2] == [2, 0]:
    	> 1
    	on [0, 2] != 1:
    		< 1
    		on 1 == 2:
    ```

- これらの他に，グリッドサイズの初期化文とマクロ定義，コメントを受け入れる．さらに将来的に拡張機能として関数定義を追加するかもしれないが，少なくとも Crop を成り立たせる上で初期化文以外は必要のない機能である．

  - ```
    init [10, 20]
    set RED 0
    ^ RED # これはコメント
    # これはコメント
    ```

## CRVM (CROP Virtual Machine)

CRVM は，Crop 言語のバイトコードを実行するための仮想マシンであり，以下のような動作を実現する．
- `INIT N M`: グリッドの大きさを N 行 M 列に設定する．これはプログラムの最初に 1 度だけ実行される．
    - バイトコード: `00010000 + byte(N) + byte(M)`
- `ROTATE D C`: グリッドを色 C を基準にして方向 D へ回転させる．
    - バイトコード: `0010 + op(D) + byte(C)`
    - `op(D)`: `0000`: 下方向，`0001`: 右方向，`0010`: 上方向，`0011`: 左方向
- `JUMPIF X Y Z`: 色 X と色 Y が同じである場合，プログラムカウンタを Z に設定する．
    - バイトコード: `00110000 + byte(X) + byte(Y) + byte(Z)`
- `JUMPIFN X Y Z`: 色 X と色 Y が同じでない場合，プログラムカウンタを Z に設定する．
    - バイトコード: `00110001 + byte(X) + byte(Y) + byte(Z)`